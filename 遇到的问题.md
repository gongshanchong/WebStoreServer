# 问题解决记录

## 08.05:

1. epoll是否需要来回设置读、写事件，是否需要设置为单次触发?
   1. 不需要设置为单次触发，由于使用的是多Reactor多线程，在处理读事件的时候不会导致多个线程处理同一个socket。
   2. 不需要在读完后设置写事件，写完后又设置读事件。本项目是在读完后直接进行数据的传递的，不需要通过epoll进行写事件的监听来进行数据的写。
2. tcp端口读写函数需要优化：
   1. 已解决，需要依据read、write的返回值和报的错进行相关的判断条件设置。

## 08.06:

1. 优化httpConn和tcp的绑定，避免重复定义：
   1. 设置一个StoreServer类，在类中定义一个无序字典，通过socket的文件描述符来进行绑定。
2. 浏览器url显示问题：
   1. 通过http报文头中的重定向来进行优化，避免GET方法直接在浏览器地址框直接显示相关文件名，以及方便通过url的删除、下载操作。

## 08.07:

1. 浏览器页面与tcp对应的关系？(get和post的区别？什么时候会建立新的tcp链接)

   1. HTTP/1.1 中 的首部字段 Connection 默认值为 keep-alive ，连接可以复用，只要发送端、接收端都没有提出断开连接，则保持tcp连接状态。http1.1中，所有的连接默认为持久连接。
   2. GET和POST的区别：[GET和POST两种基本请求方法的区别 - 在途中# - 博客园 (cnblogs.com)](https://www.cnblogs.com/logsharing/p/8448446.html)

## 08.08:

1. 上传的非文本类文件后面没有boundary：
   1. 缓冲区添加sock读取的数据时有问题，read从读缓冲区读取数据时，读出来的数据添加到程序的缓冲区时漏掉了\0导致非文本类的请求报文解析错误。
2. 请求url中带中文会被重新编码传输，需要在服务端进行重新编码获得中文：
   1. url中不能出现中文，当存储的文件是中文命名时，进行下载、删除操作时，GET请求url中的中文会乱码，需要在服务端重新编码。
3. 下载大文件下载到一半就会停止，同时也无法预览大文件：
   1. 当文件太大时，需要把读取时的临时存储字符串数组设置的小一点防止段错误。
   2. 文件已经完全读取到程序写缓冲区了，但是写入socket时出错，应该是系统写缓冲区资源不足,如果发送缓存被占满，send就会返回EAGAIN的错误,可以休眠一秒等待缓冲区清空
4. 当下载or预览加载时刷新，想当于重新建立一个连接会丢失掉username，返回的响应报文会直接跳转到起始登录页面。

## 08.10:

1. 通过浏览器预览时，由于编码原因，文本文件预览时中文为乱码：
   1. 通过请求的文件后缀名进行判断是否为文本类的文件，通过在响应报头添加Content-Type字段并指定编码格式来解决预览时的中文乱码问题。
   2. 本项目中的预览仅支持浏览器支持的文件格式。

## 09.12:

1. undefined reference to `mysql_init‘：需要把-lmysqlclient放到编译的末尾
2. 压力测试时遇到报错（Segmentation fault (core dumped) *** signal 11）：
